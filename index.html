<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Block Blast Style</title>
<style>
body{
    margin:0;
    font-family:sans-serif;
    background:#f5f9ff;
    display:flex;
    justify-content:center;
}
.screen{
    width:100%;
    max-width:480px;
    text-align:center;
}
.hidden{display:none;}
button{
    padding:12px 20px;
    font-size:18px;
    border:none;
    border-radius:12px;
    background:#4da6ff;
    color:white;
}
#board{
    display:grid;
    grid-template-columns:repeat(8,1fr);
    gap:4px;
    margin:15px;
}
.cell{
    background:#e0ecff;
    aspect-ratio:1;
    border-radius:6px;
}
#blocks{
    display:flex;
    justify-content:space-around;
    margin-bottom:20px;
}
.block{
    display:grid;
    gap:3px;
}
.block div{
    width:20px;
    height:20px;
    border-radius:4px;
}
#score{
    font-size:20px;
    margin:10px;
}
</style>
</head>
<body>

<div id="menu" class="screen">
<h1>Block Blast</h1>
<button onclick="startGame()">게임 시작</button>
<br><br>
<select id="colorMode">
<option value="random">랜덤 색상</option>
<option value="fixed">고정 색상</option>
</select>
</div>

<div id="game" class="screen hidden">
<div id="score">Score: 0</div>
<div id="board"></div>
<div id="blocks"></div>
</div>

<audio id="placeSound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.wav"></audio>
<audio id="clearSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.wav"></audio>
<audio id="overSound" src="https://assets.mixkit.co/sfx/preview/mixkit-player-losing-or-failing-2042.wav"></audio>

<script>
const boardSize=8;
let board=[];
let score=0;
let draggingShape=null;
let preview=null;
let colorMode="random";

const shapes=[
[[1]],
[[1,1]],
[[1],[1]],
[[1,1,1]],
[[1],[1],[1]],
[[1,1],[1,1]],
[[1,1,1],[0,1,0]],
[[1,0],[1,1]],
[[0,1],[1,1]],
[[1,1,0],[0,1,1]],
[[0,1,1],[1,1,0]]
];

function startGame(){
document.getElementById("menu").classList.add("hidden");
document.getElementById("game").classList.remove("hidden");
colorMode=document.getElementById("colorMode").value;
initBoard();
generateBlocks();
}

function initBoard(){
board=[];
score=0;
document.getElementById("score").innerText="Score: 0";
const boardDiv=document.getElementById("board");
boardDiv.innerHTML="";
for(let r=0;r<boardSize;r++){
let row=[];
for(let c=0;c<boardSize;c++){
row.push(0);
const cell=document.createElement("div");
cell.className="cell";
cell.dataset.r=r;
cell.dataset.c=c;
boardDiv.appendChild(cell);
}
board.push(row);
}
}

function generateBlocks(){
const blocksDiv=document.getElementById("blocks");
blocksDiv.innerHTML="";
for(let i=0;i<3;i++){
const shape=JSON.parse(JSON.stringify(shapes[Math.floor(Math.random()*shapes.length)]));
createBlock(shape);
}
}

function createBlock(shape){
const blockDiv=document.createElement("div");
blockDiv.className="block";
blockDiv.style.gridTemplateColumns=`repeat(${shape[0].length},20px)`;
const color=colorMode==="random" ? 
`hsl(${Math.random()*360},70%,60%)` : "#4da6ff";

shape.forEach(row=>{
row.forEach(cell=>{
const part=document.createElement("div");
if(cell) part.style.background=color;
blockDiv.appendChild(part);
});
});

blockDiv.addEventListener("pointerdown",()=>{
draggingShape={shape,color,element:blockDiv};
});

document.getElementById("blocks").appendChild(blockDiv);
}

document.addEventListener("pointerup",(e)=>{
if(!draggingShape) return;
const rect=document.getElementById("board").getBoundingClientRect();
const cellSize=rect.width/boardSize;
const x=Math.floor((e.clientY-rect.top)/cellSize);
const y=Math.floor((e.clientX-rect.left)/cellSize);
if(placeShape(x,y,draggingShape.shape,draggingShape.color)){
draggingShape.element.remove();
document.getElementById("placeSound").play();
if(document.getElementById("blocks").children.length===0){
generateBlocks();
}
}
draggingShape=null;
});

function placeShape(r,c,shape,color){
for(let i=0;i<shape.length;i++){
for(let j=0;j<shape[i].length;j++){
if(shape[i][j]){
if(r+i>=boardSize||c+j>=boardSize||board[r+i][c+j]) return false;
}
}
}
for(let i=0;i<shape.length;i++){
for(let j=0;j<shape[i].length;j++){
if(shape[i][j]){
board[r+i][c+j]=1;
const cell=document.querySelector(`[data-r='${r+i}'][data-c='${c+j}']`);
cell.style.background=color;
}
}
}
clearLines();
return true;
}

function clearLines(){
let cleared=false;
for(let r=0;r<boardSize;r++){
if(board[r].every(v=>v)){
for(let c=0;c<boardSize;c++){
board[r][c]=0;
document.querySelector(`[data-r='${r}'][data-c='${c}']`).style.background="#e0ecff";
}
score+=10;
cleared=true;
}
}
for(let c=0;c<boardSize;c++){
let full=true;
for(let r=0;r<boardSize;r++){
if(!board[r][c]) full=false;
}
if(full){
for(let r=0;r<boardSize;r++){
board[r][c]=0;
document.querySelector(`[data-r='${r}'][data-c='${c}']`).style.background="#e0ecff";
}
score+=10;
cleared=true;
}
}
if(cleared){
document.getElementById("clearSound").play();
}
document.getElementById("score").innerText="Score: "+score;
}
</script>

</body>
</html>
